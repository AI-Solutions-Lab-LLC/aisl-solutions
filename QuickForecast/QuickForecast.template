{
  "Description": "(SO0123) - Automate Amazon Forecast predictor and forecast generation and visualize forecasts via Amazon QuickSight or an Amazon SageMaker Jupyter Notebook. Version v1.5.5",
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Notification Configuration"
          },
          "Parameters": [
            "Email"
          ]
        },
        {
          "Label": {
            "default": "Visualization Options"
          },
          "Parameters": [
            "NotebookDeploy",
            "NotebookInstanceType",
            "NotebookVolumeSize",
            "QuickSightAnalysisOwner"
          ]
        },
        {
          "Label": {
            "default": "Security Configuration"
          },
          "Parameters": [
            "ForecastKmsKeyArn"
          ]
        },
        {
          "Label": {
            "default": "Forecast Configuration"
          },
          "Parameters": [
            "ForecastDeploy",
            "ForecastStackParametersForecastNameDF9B9CAC",
            "ForecastStackParametersForecastDefaultsUrl7C63E324"
          ]
        },
        {
          "Label": {
            "default": "Dataset Configuration"
          },
          "Parameters": [
            "ForecastStackParametersTargetTimeSeriesUrlF02035C1",
            "ForecastStackParametersRelatedTimeSeriesUrl7D41C268",
            "ForecastStackParametersMetadataUrl06727156"
          ]
        },
        {
          "Label": {
            "default": "Deployment Configuration"
          },
          "Parameters": [
            "LambdaLogLevel"
          ]
        }
      ],
      "ParameterLabels": {
        "Email": {
          "default": "Email"
        },
        "NotebookDeploy": {
          "default": "Deploy Jupyter Notebook"
        },
        "NotebookInstanceType": {
          "default": "Jupyter Notebook Instance Type"
        },
        "NotebookVolumeSize": {
          "default": "Jupyter Notebook Volume Size"
        },
        "QuickSightAnalysisOwner": {
          "default": "(Optional) Deploy QuickSight Dashboard"
        },
        "ForecastKmsKeyArn": {
          "default": "(Optional) KMS key ARN used to encrypt Datasets and Predictors managed by Amazon Forecast"
        },
        "ForecastDeploy": {
          "default": "Demo / Forecast Deployment"
        },
        "ForecastStackParametersForecastNameDF9B9CAC": {
          "default": "(Optional) Forecast Name"
        },
        "ForecastStackParametersForecastDefaultsUrl7C63E324": {
          "default": "(Optional) Default forecast configuration file URL"
        },
        "ForecastStackParametersTargetTimeSeriesUrlF02035C1": {
          "default": "(Optional) Target Time Series URL"
        },
        "ForecastStackParametersRelatedTimeSeriesUrl7D41C268": {
          "default": "(Optional) Related Time Series URL"
        },
        "ForecastStackParametersMetadataUrl06727156": {
          "default": "(Optional) Item Metadata URL"
        },
        "LambdaLogLevel": {
          "default": "CloudWatch Log Level"
        }
      }
    },
    "aws:solutions:templatename": "improving-forecast-accuracy-with-machine-learning.template"
  },
  "Mappings": {
    "Solution": {
      "Data": {
        "ID": "SO0123",
        "Version": "v1.5.5",
        "SendAnonymousUsageData": "Yes",
        "SolutionName": "improving-forecast-accuracy-with-machine-learning",
        "AppRegistryName": "forecast-ml",
        "ApplicationType": "AWS-Solutions"
      }
    },
    "SourceCode": {
      "General": {
        "S3Bucket": "solutions",
        "KeyPrefix": "improving-forecast-accuracy-with-machine-learning/v1.5.5",
        "QuickSightSourceTemplateArn": ""
      }
    },
    "ServiceprincipalMap": {
      "af-south-1": {
        "states": "states.af-south-1.amazonaws.com"
      },
      "ap-east-1": {
        "states": "states.ap-east-1.amazonaws.com"
      },
      "ap-northeast-1": {
        "states": "states.ap-northeast-1.amazonaws.com"
      },
      "ap-northeast-2": {
        "states": "states.ap-northeast-2.amazonaws.com"
      },
      "ap-northeast-3": {
        "states": "states.ap-northeast-3.amazonaws.com"
      },
      "ap-south-1": {
        "states": "states.ap-south-1.amazonaws.com"
      },
      "ap-south-2": {
        "states": "states.ap-south-2.amazonaws.com"
      },
      "ap-southeast-1": {
        "states": "states.ap-southeast-1.amazonaws.com"
      },
      "ap-southeast-2": {
        "states": "states.ap-southeast-2.amazonaws.com"
      },
      "ap-southeast-3": {
        "states": "states.ap-southeast-3.amazonaws.com"
      },
      "ca-central-1": {
        "states": "states.ca-central-1.amazonaws.com"
      },
      "cn-north-1": {
        "states": "states.cn-north-1.amazonaws.com"
      },
      "cn-northwest-1": {
        "states": "states.cn-northwest-1.amazonaws.com"
      },
      "eu-central-1": {
        "states": "states.eu-central-1.amazonaws.com"
      },
      "eu-central-2": {
        "states": "states.eu-central-2.amazonaws.com"
      },
      "eu-north-1": {
        "states": "states.eu-north-1.amazonaws.com"
      },
      "eu-south-1": {
        "states": "states.eu-south-1.amazonaws.com"
      },
      "eu-south-2": {
        "states": "states.eu-south-2.amazonaws.com"
      },
      "eu-west-1": {
        "states": "states.eu-west-1.amazonaws.com"
      },
      "eu-west-2": {
        "states": "states.eu-west-2.amazonaws.com"
      },
      "eu-west-3": {
        "states": "states.eu-west-3.amazonaws.com"
      },
      "me-central-1": {
        "states": "states.me-central-1.amazonaws.com"
      },
      "me-south-1": {
        "states": "states.me-south-1.amazonaws.com"
      },
      "sa-east-1": {
        "states": "states.sa-east-1.amazonaws.com"
      },
      "us-east-1": {
        "states": "states.us-east-1.amazonaws.com"
      },
      "us-east-2": {
        "states": "states.us-east-2.amazonaws.com"
      },
      "us-gov-east-1": {
        "states": "states.us-gov-east-1.amazonaws.com"
      },
      "us-gov-west-1": {
        "states": "states.us-gov-west-1.amazonaws.com"
      },
      "us-iso-east-1": {
        "states": "states.amazonaws.com"
      },
      "us-iso-west-1": {
        "states": "states.amazonaws.com"
      },
      "us-isob-east-1": {
        "states": "states.amazonaws.com"
      },
      "us-west-1": {
        "states": "states.us-west-1.amazonaws.com"
      },
      "us-west-2": {
        "states": "states.us-west-2.amazonaws.com"
      }
    }
  },
  "Parameters": {
    "ForecastStackParametersForecastNameDF9B9CAC": {
      "Type": "String",
      "Default": "nyctaxi_weather_auto",
      "AllowedPattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
      "ConstraintDescription": "Forecast names must be less than 63 characters, start with a letter, and contain only alphanumeric characters or underscores",
      "Description": "Name of the forecast to create in the Amazon Forecast console",
      "MaxLength": 63
    },
    "ForecastStackParametersForecastDefaultsUrl7C63E324": {
      "Type": "String",
      "Default": "s3://amazon-forecast-samples/automation_solution/demo-nyctaxi/forecast-defaults.yaml",
      "AllowedPattern": "^https?://([-\\w\\.]+)+(:\\d+)?(/([-\\w/_\\.]*(\\?\\S+)?)?)?$|^s3://(.*)/(.*)$",
      "ConstraintDescription": "Must be a valid s3/http/https address",
      "Description": "URL (S3, HTTP or HTTPS) your forecast defaults file (usually named forecast-defaults.yaml)"
    },
    "ForecastStackParametersTargetTimeSeriesUrlF02035C1": {
      "Type": "String",
      "Default": "s3://amazon-forecast-samples/automation_solution/demo-nyctaxi/nyctaxi_weather_auto.csv",
      "AllowedPattern": "^https?://([-\\w\\.]+)+(:\\d+)?(/([-\\w/_\\.]*(\\?\\S+)?)?)?$|^s3://(.*)/(.*)$",
      "ConstraintDescription": "Must be a valid s3/http/https address",
      "Description": "URL (S3, HTTP or HTTPS) for target time series data"
    },
    "ForecastStackParametersRelatedTimeSeriesUrl7D41C268": {
      "Type": "String",
      "Default": "s3://amazon-forecast-samples/automation_solution/demo-nyctaxi/nyctaxi_weather_auto.related.csv",
      "AllowedPattern": "^https?://([-\\w\\.]+)+(:\\d+)?(/([-\\w/_\\.]*(\\?\\S+)?)?)?$|^s3://(.*)/(.*)$|^$",
      "ConstraintDescription": "Must be a valid s3/http/https address or blank",
      "Description": "URL (S3, HTTP or HTTPS) for related time series data"
    },
    "ForecastStackParametersMetadataUrl06727156": {
      "Type": "String",
      "Default": "s3://amazon-forecast-samples/automation_solution/demo-nyctaxi/nyctaxi_weather_auto.metadata.csv",
      "AllowedPattern": "^https?://([-\\w\\.]+)+(:\\d+)?(/([-\\w/_\\.]*(\\?\\S+)?)?)?$|^s3://(.*)/(.*)$|^$",
      "ConstraintDescription": "Must be a valid http/https address or blank",
      "Description": "URL (S3, HTTP or HTTPS) for item metadata"
    },
    "Email": {
      "Type": "String",
      "Default": "",
      "AllowedPattern": "(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$|^$)",
      "ConstraintDescription": "Must be a valid email address or blank",
      "Description": "Email to notify with forecast results",
      "MaxLength": 50
    },
    "LambdaLogLevel": {
      "Type": "String",
      "Default": "WARNING",
      "AllowedValues": [
        "DEBUG",
        "INFO",
        "WARNING",
        "ERROR",
        "CRITICAL"
      ],
      "Description": "Change the verbosity of the logs output to CloudWatch"
    },
    "NotebookDeploy": {
      "Type": "String",
      "Default": "No",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Deploy an Amazon SageMaker Jupyter Notebook instance"
    },
    "NotebookVolumeSize": {
      "Type": "Number",
      "Default": 10,
      "ConstraintDescription": "Must be an integer between 5 (GB) and 16384 (16 TB)",
      "Description": "Enter the size of the notebook instance EBS volume in GB",
      "MaxValue": 16384,
      "MinValue": 5
    },
    "NotebookInstanceType": {
      "Type": "String",
      "Default": "ml.t3.medium",
      "AllowedValues": [
        "ml.t2.medium",
        "ml.t3.medium",
        "ml.r5.large",
        "ml.c5.large"
      ],
      "Description": "Enter the type of the notebook instance"
    },
    "QuickSightAnalysisOwner": {
      "Type": "String",
      "Default": "",
      "AllowedPattern": "(^arn:.*:quicksight:.*:.*:user.*$|^$)",
      "Description": "With QuickSight Enterprise enabled, provide a QuickSight ADMIN user ARN to automatically create QuickSight analyses"
    },
    "ForecastKmsKeyArn": {
      "Type": "String",
      "Default": "",
      "AllowedPattern": "(^arn:.*:kms:.*:.*:key/.*$|^$)",
      "Description": "Provide Amazon Forecast with an alternate AWS Key Management (KMS) key to use for CreatePredictor and CreateDataset operations"
    },
    "ForecastDeploy": {
      "Type": "String",
      "Default": "No",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Download and deploy these assets with the stack"
    }
  },
  "Conditions": {
    "CreateNotebook": {
      "Fn::Equals": [
        {
          "Ref": "NotebookDeploy"
        },
        "Yes"
      ]
    },
    "EmailProvided": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "Email"
            },
            ""
          ]
        }
      ]
    },
    "CreateAnalysis": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "QuickSightAnalysisOwner"
            },
            ""
          ]
        }
      ]
    },
    "ForecastSseKmsEnabled": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ForecastKmsKeyArn"
            },
            ""
          ]
        }
      ]
    },
    "CreateForecast": {
      "Fn::Equals": [
        {
          "Ref": "ForecastDeploy"
        },
        "Yes"
      ]
    },
    "ForecastDefaultsForecastDefaultsURLProvided996F6EEE": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ForecastStackParametersForecastDefaultsUrl7C63E324"
            },
            ""
          ]
        }
      ]
    },
    "TTSTTSURLProvidedCB709844": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ForecastStackParametersTargetTimeSeriesUrlF02035C1"
            },
            ""
          ]
        }
      ]
    },
    "RTSRTSURLProvided5D71A457": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ForecastStackParametersRelatedTimeSeriesUrl7D41C268"
            },
            ""
          ]
        }
      ]
    },
    "MDMDURLProvided1BEF6CAA": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ForecastStackParametersMetadataUrl06727156"
            },
            ""
          ]
        }
      ]
    }
  },
  "Resources": {
    "DataBucketNameDataBucketNameNameResourceF097015A": {
      "Type": "Custom::ResourceName",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "ResourceNameFunctiond45b185afe3444aba37517f89597d9ec4F793A21",
            "Arn"
          ]
        },
        "Purpose": "data-bucket",
        "StackName": {
          "Ref": "AWS::StackName"
        },
        "MaxLength": 63
      }
    },
    "ResourceNameFunctiond45b185afe3444aba37517f89597d9ecRoleE234DCDF": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "ResourceNameFunctiond45b185afe3444aba37517f89597d9ec4F793A21": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "ResourceNameFunctiond45b185afe3444aba37517f89597d9ec4F793A21.zip"
              ]
            ]
          }
        },
        "Handler": "name.handler",
        "Role": {
          "Fn::GetAtt": [
            "ResourceNameFunctiond45b185afe3444aba37517f89597d9ecRoleE234DCDF",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "DependsOn": [
        "ResourceNameFunctiond45b185afe3444aba37517f89597d9ecRoleE234DCDF"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "AccessLogsBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter"
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W35",
              "reason": "This bucket is used as the logging destination for personalization data processing"
            }
          ]
        }
      }
    },
    "AccessLogsBucketPolicy7F77476F": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "AccessLogsBucket"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": false
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "AccessLogsBucket",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            },
            {
              "Action": "s3:PutObject",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": [
                    {
                      "Fn::GetAtt": [
                        "AthenaBucket",
                        "Arn"
                      ]
                    }
                  ]
                },
                "StringEquals": {
                  "aws:SourceAccount": {
                    "Ref": "AWS::AccountId"
                  }
                }
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "logging.s3.amazonaws.com"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "AccessLogsBucket",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "S3ServerAccessLogsPolicy"
            },
            {
              "Action": "s3:PutObject",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": [
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                },
                "StringEquals": {
                  "aws:SourceAccount": {
                    "Ref": "AWS::AccountId"
                  }
                }
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "logging.s3.amazonaws.com"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "AccessLogsBucket",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "S3ServerAccessLogsPolicy"
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "AthenaBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "AccessLogsBucket"
          },
          "LogFilePrefix": "athena-bucket-access-logs/"
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain"
    },
    "AthenaBucketPolicy63CE2A16": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "AthenaBucket"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": false
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "AthenaBucket",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "ForecastBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "BucketName": {
          "Fn::GetAtt": [
            "DataBucketNameDataBucketNameNameResourceF097015A",
            "Name"
          ]
        },
        "LifecycleConfiguration": {
          "Rules": [
            {
              "AbortIncompleteMultipartUpload": {
                "DaysAfterInitiation": 3
              },
              "Status": "Enabled"
            },
            {
              "ExpirationInDays": 1,
              "Prefix": "raw/",
              "Status": "Enabled"
            }
          ]
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "AccessLogsBucket"
          },
          "LogFilePrefix": "forecast-bucket-access-logs/"
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "Tags": [
          {
            "Key": "aws-cdk:cr-owned:notebooks:ba32360b",
            "Value": "true"
          },
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain"
    },
    "ForecastBucketPolicyE81828D5": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "ForecastBucket"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": false
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "ForecastBucketNotifications80D4C093": {
      "Type": "Custom::S3BucketNotifications",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
            "Arn"
          ]
        },
        "BucketName": {
          "Ref": "ForecastBucket"
        },
        "NotificationConfiguration": {
          "LambdaFunctionConfigurations": [
            {
              "Events": [
                "s3:ObjectCreated:*"
              ],
              "Filter": {
                "Key": {
                  "FilterRules": [
                    {
                      "Name": "suffix",
                      "Value": ".csv"
                    },
                    {
                      "Name": "prefix",
                      "Value": "train/"
                    }
                  ]
                }
              },
              "LambdaFunctionArn": {
                "Fn::GetAtt": [
                  "S3EventHandlerBAFC08A8",
                  "Arn"
                ]
              }
            }
          ]
        },
        "Managed": true
      },
      "DependsOn": [
        "ForecastBucketAllowBucketNotificationsToforecaststackcdkS3EventHandler3E011B174868A429"
      ]
    },
    "ForecastBucketAllowBucketNotificationsToforecaststackcdkS3EventHandler3E011B174868A429": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "S3EventHandlerBAFC08A8",
            "Arn"
          ]
        },
        "Principal": "s3.amazonaws.com",
        "SourceAccount": {
          "Ref": "AWS::AccountId"
        },
        "SourceArn": {
          "Fn::GetAtt": [
            "ForecastBucket",
            "Arn"
          ]
        }
      }
    },
    "ForecastPolicyFactoryForecastKmsReadAccess040ED780": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:GenerateDataKey"
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "ForecastKmsKeyArn"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "ForecastPolicyFactoryForecastKmsReadAccess040ED780",
        "Roles": [
          {
            "Ref": "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F"
          },
          {
            "Ref": "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD"
          }
        ]
      },
      "Condition": "ForecastSseKmsEnabled"
    },
    "ForecastPolicyFactoryForecastKmsWriteAccessCD45AEBB": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "kms:Encrypt",
                "kms:ReEncrypt",
                "kms:Decrypt",
                "kms:CreateGrant",
                "kms:RevokeGrant",
                "kms:RetireGrant",
                "kms:ListGrants",
                "kms:GenerateDataKey",
                "kms:DescribeKey"
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "ForecastKmsKeyArn"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "ForecastPolicyFactoryForecastKmsWriteAccessCD45AEBB",
        "Roles": [
          {
            "Ref": "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD"
          }
        ]
      },
      "Condition": "ForecastSseKmsEnabled"
    },
    "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "forecast.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:Get*",
                    "s3:List*"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "ForecastBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "ForecastS3ReadRole"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "forecast.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:Get*",
                    "s3:List*",
                    "s3:PutObject"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "ForecastBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "ForecastS3ReadWriteRole"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "SolutionLayerE608004D": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
        "Content": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "SolutionLayerE608004D.zip"
              ]
            ]
          }
        }
      }
    },
    "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRole6F41EBC2": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRoleDefaultPolicy5D395EF3": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRoleDefaultPolicy5D395EF3",
        "Roles": [
          {
            "Ref": "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRole6F41EBC2"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateDatasetGroupSolutionStepcreatedatasetgroupfnC735977A": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateDatasetGroupSolutionStepcreatedatasetgroupfnC735977A.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "handler.createdatasetgroup",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRole6F41EBC2",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRoleDefaultPolicy5D395EF3",
        "CreateDatasetGroupSolutionStepcreatedatasetgroupfnRole6F41EBC2"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRole104D7217": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRoleDefaultPolicy94CDD9C1": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRoleDefaultPolicy94CDD9C1",
        "Roles": [
          {
            "Ref": "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRole104D7217"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfn0CDCEAE0": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfn0CDCEAE0.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "handler.createdatasetimportjob",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRole104D7217",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRoleDefaultPolicy94CDD9C1",
        "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfnRole104D7217"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreatePredictorSolutionStepcreatepredictorfnRole667AFDD3": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreatePredictorSolutionStepcreatepredictorfnRoleDefaultPolicy248E026D": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreatePredictorSolutionStepcreatepredictorfnRoleDefaultPolicy248E026D",
        "Roles": [
          {
            "Ref": "CreatePredictorSolutionStepcreatepredictorfnRole667AFDD3"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreatePredictorSolutionStepcreatepredictorfn3D529839": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreatePredictorSolutionStepcreatepredictorfn3D529839.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "create_predictor.handler",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreatePredictorSolutionStepcreatepredictorfnRole667AFDD3",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreatePredictorSolutionStepcreatepredictorfnRoleDefaultPolicy248E026D",
        "CreatePredictorSolutionStepcreatepredictorfnRole667AFDD3"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreateForecastSolutionStepcreateforecastfnRoleDEAC6254": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreateForecastSolutionStepcreateforecastfnRoleDefaultPolicyDFCC2329": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateForecastSolutionStepcreateforecastfnRoleDefaultPolicyDFCC2329",
        "Roles": [
          {
            "Ref": "CreateForecastSolutionStepcreateforecastfnRoleDEAC6254"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateForecastSolutionStepcreateforecastfnDD3349B0": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateForecastSolutionStepcreateforecastfnDD3349B0.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "create_forecast.handler",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateForecastSolutionStepcreateforecastfnRoleDEAC6254",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateForecastSolutionStepcreateforecastfnRoleDefaultPolicyDFCC2329",
        "CreateForecastSolutionStepcreateforecastfnRoleDEAC6254"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreateForecastExportSolutionStepcreateforecastexportfnRoleBA3F6E81": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreateForecastExportSolutionStepcreateforecastexportfnRoleDefaultPolicy66ABF649": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateForecastExportSolutionStepcreateforecastexportfnRoleDefaultPolicy66ABF649",
        "Roles": [
          {
            "Ref": "CreateForecastExportSolutionStepcreateforecastexportfnRoleBA3F6E81"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateForecastExportSolutionStepcreateforecastexportfnD35AA3C7": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateForecastExportSolutionStepcreateforecastexportfnD35AA3C7.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "create_forecast_export.handler",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateForecastExportSolutionStepcreateforecastexportfnRoleBA3F6E81",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateForecastExportSolutionStepcreateforecastexportfnRoleDefaultPolicy66ABF649",
        "CreateForecastExportSolutionStepcreateforecastexportfnRoleBA3F6E81"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRole3E441DBF": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRoleDefaultPolicyE0300888": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRoleDefaultPolicyE0300888",
        "Roles": [
          {
            "Ref": "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRole3E441DBF"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfn909FEBAB": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfn909FEBAB.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadWriteRole3FAB5ECD",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            }
          }
        },
        "Handler": "create_predictor_backtest_export.handler",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRole3E441DBF",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 180,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRoleDefaultPolicyE0300888",
        "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfnRole3E441DBF"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreateGlueTableNameSolutionStepcreategluetablenamefnRole5771417F": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "CreateGlueTableNameSolutionStepcreategluetablenamefnRoleDefaultPolicy51B1FCC0": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateGlueTableNameSolutionStepcreategluetablenamefnRoleDefaultPolicy51B1FCC0",
        "Roles": [
          {
            "Ref": "CreateGlueTableNameSolutionStepcreategluetablenamefnRole5771417F"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateGlueTableNameSolutionStepcreategluetablenamefnC8DC1B5F": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateGlueTableNameSolutionStepcreategluetablenamefnC8DC1B5F.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            }
          }
        },
        "Handler": "handler.creategluetablename",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateGlueTableNameSolutionStepcreategluetablenamefnRole5771417F",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 15,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateGlueTableNameSolutionStepcreategluetablenamefnRoleDefaultPolicy51B1FCC0",
        "CreateGlueTableNameSolutionStepcreategluetablenamefnRole5771417F"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleE0AA0FE6": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W76",
              "reason": "Access to Glue, QuickSight and S3 require a large number of permissions"
            },
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            }
          ]
        }
      }
    },
    "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleDefaultPolicy88F1044A": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "forecast:Describe*",
                "forecast:List*",
                "forecast:Create*",
                "forecast:Update*",
                "forecast:TagResource"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "athena:StartQueryExecution",
                "athena:GetQueryExecution",
                "athena:GetQueryResults"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":athena:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":workgroup/",
                    {
                      "Ref": "AthenaWorkGroup"
                    }
                  ]
                ]
              }
            },
            {
              "Action": [
                "glue:GetDatabase",
                "glue:GetTable",
                "glue:GetPartitions",
                "glue:DeleteTable",
                "glue:CreateTable",
                "glue:BatchCreatePartition"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":catalog"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":",
                      {
                        "Ref": "DataCatalog"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":table/",
                      {
                        "Ref": "DataCatalog"
                      },
                      "/*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":glue:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":database/",
                      {
                        "Ref": "DataCatalog"
                      }
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetBucketLocation",
                "s3:GetObject",
                "s3:ListBucket",
                "s3:ListObjects",
                "s3:PutObject",
                "s3:CreateMultipartUpload",
                "s3:ListMultipartUploadParts",
                "s3:AbortMultipartUpload"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AthenaBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                },
                {
                  "Fn::GetAtt": [
                    "AthenaBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                },
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                }
              ]
            },
            {
              "Action": [
                "quicksight:CreateAnalysis",
                "quicksight:CreateDataSet",
                "quicksight:CreateDataSource",
                "quicksight:UpdateDataSource",
                "quicksight:UpdateDataSourcePermissions",
                "quicksight:Describe*",
                "quicksight:Get*",
                "quicksight:List*",
                "quicksight:PassDataSet",
                "quicksight:PassDataSource",
                "quicksight:RestoreAnalysis",
                "quicksight:SearchAnalyses"
              ],
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleDefaultPolicy88F1044A",
        "Roles": [
          {
            "Ref": "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleE0AA0FE6"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfn07FD2505": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfn07FD2505.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            },
            "FORECAST_ROLE": {
              "Fn::GetAtt": [
                "ForecastPolicyFactoryForecastS3ReadRoleA9011A6F",
                "Arn"
              ]
            },
            "FORECAST_KMS": {
              "Ref": "ForecastKmsKeyArn"
            },
            "SCHEMA_NAME": {
              "Ref": "DataCatalog"
            },
            "WORKGROUP_NAME": {
              "Ref": "AthenaWorkGroup"
            },
            "QUICKSIGHT_PRINCIPAL": {
              "Ref": "QuickSightAnalysisOwner"
            },
            "QUICKSIGHT_SOURCE": {
              "Fn::FindInMap": [
                "SourceCode",
                "General",
                "QuickSightSourceTemplateArn"
              ]
            }
          }
        },
        "Handler": "handler.createquicksightanalysis",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleE0AA0FE6",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 900,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleDefaultPolicy88F1044A",
        "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfnRoleE0AA0FE6"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "SNSNotificationSolutionStepsnsnotificationfnRole5A54A784": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "SNSNotificationSolutionStepsnsnotificationfnRoleDefaultPolicy96503559": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "NotificationTopic"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "SNSNotificationSolutionStepsnsnotificationfnRoleDefaultPolicy96503559",
        "Roles": [
          {
            "Ref": "SNSNotificationSolutionStepsnsnotificationfnRole5A54A784"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "SNSNotificationSolutionStepsnsnotificationfn6973DEFB": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "SNSNotificationSolutionStepsnsnotificationfn6973DEFB.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "SNS_TOPIC_ARN": {
              "Ref": "NotificationTopic"
            },
            "SNS_TOPIC_NAME": {
              "Fn::GetAtt": [
                "NotificationTopic",
                "TopicName"
              ]
            },
            "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
            "SOLUTION_ID": "SO0123",
            "SOLUTION_VERSION": "v1.5.5",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_SERVICE_NAME": "Workflow",
            "POWERTOOLS_METRICS_NAMESPACE": {
              "Fn::Join": [
                "",
                [
                  "forecast_solution_",
                  {
                    "Ref": "AWS::StackName"
                  }
                ]
              ]
            }
          }
        },
        "Handler": "handler.sns",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "SNSNotificationSolutionStepsnsnotificationfnRole5A54A784",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 15,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "SNSNotificationSolutionStepsnsnotificationfnRoleDefaultPolicy96503559",
        "SNSNotificationSolutionStepsnsnotificationfnRole5A54A784"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "NotificationTopic": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "DisplayName": "improving-forecast-accuracy-with-machine-learning Notifications",
        "KmsMasterKeyId": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":kms:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":alias/aws/sns"
            ]
          ]
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "SNSNotificationSolutionStepNotificationConfigurationSnsTopicPolicy65B05D41": {
      "Type": "AWS::SNS::TopicPolicy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "SNS:Publish",
                "SNS:RemovePermission",
                "SNS:SetTopicAttributes",
                "SNS:DeleteTopic",
                "SNS:ListSubscriptionsByTopic",
                "SNS:GetTopicAttributes",
                "SNS:Receive",
                "SNS:AddPermission",
                "SNS:Subscribe"
              ],
              "Condition": {
                "StringEquals": {
                  "AWS:SourceOwner": {
                    "Ref": "AWS::AccountId"
                  }
                }
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              },
              "Resource": {
                "Ref": "NotificationTopic"
              },
              "Sid": "TopicOwnerOnlyAccess"
            },
            {
              "Action": [
                "SNS:Publish",
                "SNS:RemovePermission",
                "SNS:SetTopicAttributes",
                "SNS:DeleteTopic",
                "SNS:ListSubscriptionsByTopic",
                "SNS:GetTopicAttributes",
                "SNS:Receive",
                "SNS:AddPermission",
                "SNS:Subscribe"
              ],
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Ref": "NotificationTopic"
              },
              "Sid": "HttpsOnly"
            }
          ],
          "Version": "2012-10-17"
        },
        "Topics": [
          {
            "Ref": "NotificationTopic"
          }
        ]
      }
    },
    "NotificationSubscription": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "Endpoint": {
          "Ref": "Email"
        },
        "Protocol": "email",
        "TopicArn": {
          "Ref": "NotificationTopic"
        }
      },
      "Condition": "EmailProvided"
    },
    "StateMachineNameStateMachineNameNameResource5B98B370": {
      "Type": "Custom::ResourceName",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "ResourceNameFunctiond45b185afe3444aba37517f89597d9ec4F793A21",
            "Arn"
          ]
        },
        "Purpose": "forecast-workflow",
        "StackName": {
          "Ref": "AWS::StackName"
        },
        "MaxLength": 80
      }
    },
    "ForecastStateMachineRoleAAB47A61": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": {
                  "Fn::FindInMap": [
                    "ServiceprincipalMap",
                    {
                      "Ref": "AWS::Region"
                    },
                    "states"
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W76",
              "reason": "Large step functions need larger IAM roles to access all managed lambda functions"
            },
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            }
          ]
        }
      }
    },
    "ForecastStateMachineRoleDefaultPolicy42147EF0": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "SNSNotificationSolutionStepsnsnotificationfn6973DEFB",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SNSNotificationSolutionStepsnsnotificationfn6973DEFB",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateDatasetGroupSolutionStepcreatedatasetgroupfnC735977A",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateDatasetGroupSolutionStepcreatedatasetgroupfnC735977A",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfn0CDCEAE0",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfn0CDCEAE0",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreatePredictorSolutionStepcreatepredictorfn3D529839",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreatePredictorSolutionStepcreatepredictorfn3D529839",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateForecastSolutionStepcreateforecastfnDD3349B0",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateForecastSolutionStepcreateforecastfnDD3349B0",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateGlueTableNameSolutionStepcreategluetablenamefnC8DC1B5F",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateGlueTableNameSolutionStepcreategluetablenamefnC8DC1B5F",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "glue:StartJobRun",
                "glue:GetJobRun",
                "glue:GetJobRuns",
                "glue:BatchStopJobRun"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":glue:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":job/",
                    {
                      "Ref": "AWS::StackName"
                    },
                    "-Forecast-ETL"
                  ]
                ]
              }
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfn07FD2505",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfn07FD2505",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreateForecastExportSolutionStepcreateforecastexportfnD35AA3C7",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreateForecastExportSolutionStepcreateforecastexportfnD35AA3C7",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfn909FEBAB",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfn909FEBAB",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "ForecastStateMachineRoleDefaultPolicy42147EF0",
        "Roles": [
          {
            "Ref": "ForecastStateMachineRoleAAB47A61"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            },
            {
              "id": "W12",
              "reason": "IAM policy should not allow * resource"
            }
          ]
        }
      }
    },
    "ForecastStateMachine425DE76B": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{\"StartAt\":\"Check for Error\",\"States\":{\"Check for Error\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.error.serviceError\",\"IsPresent\":true,\"Next\":\"Notify on Failure\"}],\"Default\":\"Manage the Execution\"},\"Manage the Execution\":{\"Type\":\"Parallel\",\"End\":true,\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"Notify on Failure\"}],\"Branches\":[{\"StartAt\":\"Create Dataset Group\",\"States\":{\"Create Dataset Group\":{\"Next\":\"Create Dataset Import Job\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":5,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.DatasetGroupNames\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateDatasetGroupSolutionStepcreatedatasetgroupfnC735977A",
                  "Arn"
                ]
              },
              "\"},\"Create Dataset Import Job\":{\"Next\":\"Create Forecasts\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":120,\"MaxAttempts\":100,\"BackoffRate\":1.02}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.DatasetImportJobArn\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateDatasetImportJobSolutionStepcreatedatasetimportjobfn0CDCEAE0",
                  "Arn"
                ]
              },
              "\"},\"Create Forecasts\":{\"Type\":\"Map\",\"End\":true,\"Parameters\":{\"bucket.$\":\"$.bucket\",\"dataset_file.$\":\"$.dataset_file\",\"dataset_group_name.$\":\"$$.Map.Item.Value\",\"config.$\":\"$.config\"},\"Iterator\":{\"StartAt\":\"Create Predictor\",\"States\":{\"Create Predictor\":{\"Next\":\"Create Forecast\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":120,\"MaxAttempts\":100,\"BackoffRate\":1.02},{\"ErrorEquals\":[\"DatasetsImporting\"],\"IntervalSeconds\":120,\"MaxAttempts\":100,\"BackoffRate\":1.02}],\"Catch\":[{\"ErrorEquals\":[\"NotMostRecentUpdate\"],\"Next\":\"Update Not Required\"}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.PredictorArn\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreatePredictorSolutionStepcreatepredictorfn3D529839",
                  "Arn"
                ]
              },
              "\"},\"Create Forecast\":{\"Next\":\"Export Predictor Backtest and Forecast\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":100,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.ForecastArn\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateForecastSolutionStepcreateforecastfnDD3349B0",
                  "Arn"
                ]
              },
              "\"},\"Export Predictor Backtest and Forecast\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"Next\":\"Create Glue Table Name\",\"Branches\":[{\"StartAt\":\"Create Forecast Export\",\"States\":{\"Create Forecast Export\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":100,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.PredictorArn\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateForecastExportSolutionStepcreateforecastexportfnD35AA3C7",
                  "Arn"
                ]
              },
              "\"}}},{\"StartAt\":\"Create Predictor Backtest Export\",\"States\":{\"Create Predictor Backtest Export\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":100,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.PredictorArn\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreatePredictorBacktestExportSolutionStepcreatepredictorbacktestexportfn909FEBAB",
                  "Arn"
                ]
              },
              "\"}}}]},\"Create Glue Table Name\":{\"Next\":\"Forecast ETL\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":5,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":\"$.glue_table_name\",\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateGlueTableNameSolutionStepcreategluetablenamefnC8DC1B5F",
                  "Arn"
                ]
              },
              "\"},\"Forecast ETL\":{\"Next\":\"Create QuickSight Analysis\",\"Retry\":[{\"ErrorEquals\":[\"Glue.ConcurrentRunsExceededException\"],\"IntervalSeconds\":120,\"MaxAttempts\":100,\"BackoffRate\":1.02}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::glue:startJobRun.sync\",\"Parameters\":{\"JobName\":\"",
              {
                "Ref": "AWS::StackName"
              },
              "-Forecast-ETL\",\"Arguments\":{\"--dataset_group.$\":\"$.dataset_group_name\",\"--glue_table_name.$\":\"$.glue_table_name\"}}},\"Create QuickSight Analysis\":{\"Next\":\"Notify on Success\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":5,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":null,\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "CreateQuickSightAnalysisSolutionStepcreatequicksightanalysisfn07FD2505",
                  "Arn"
                ]
              },
              "\"},\"Notify on Success\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":5,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":null,\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "SNSNotificationSolutionStepsnsnotificationfn6973DEFB",
                  "Arn"
                ]
              },
              "\"},\"Update Not Required\":{\"Type\":\"Succeed\"}}},\"ItemsPath\":\"$.DatasetGroupNames\"}}}]},\"Notify on Failure\":{\"Next\":\"Failure\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"ResourcePending\"],\"IntervalSeconds\":5,\"MaxAttempts\":5,\"BackoffRate\":1.05}],\"Type\":\"Task\",\"InputPath\":\"$\",\"OutputPath\":\"$\",\"ResultPath\":null,\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "SNSNotificationSolutionStepsnsnotificationfn6973DEFB",
                  "Arn"
                ]
              },
              "\"},\"Failure\":{\"Type\":\"Fail\"}}}"
            ]
          ]
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "ForecastStateMachineRoleAAB47A61",
            "Arn"
          ]
        },
        "StateMachineName": {
          "Fn::GetAtt": [
            "StateMachineNameStateMachineNameNameResource5B98B370",
            "Name"
          ]
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "TracingConfiguration": {
          "Enabled": true
        }
      },
      "DependsOn": [
        "ForecastStateMachineRoleDefaultPolicy42147EF0",
        "ForecastStateMachineRoleAAB47A61"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "S3EventHandlerRole822B3D57": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "S3EventHandlerRoleDefaultPolicy4200EF33": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ForecastStateMachine425DE76B"
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/train/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ForecastBucket",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ForecastBucket",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "S3EventHandlerRoleDefaultPolicy4200EF33",
        "Roles": [
          {
            "Ref": "S3EventHandlerRole822B3D57"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "IAM policy for AWS X-Ray requires an allow on *"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "S3EventHandlerBAFC08A8": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "S3EventHandlerBAFC08A8.zip"
              ]
            ]
          }
        },
        "Environment": {
          "Variables": {
            "STATE_MACHINE_ARN": {
              "Ref": "ForecastStateMachine425DE76B"
            }
          }
        },
        "Handler": "handler.notification",
        "Layers": [
          {
            "Ref": "SolutionLayerE608004D"
          }
        ],
        "Role": {
          "Fn::GetAtt": [
            "S3EventHandlerRole822B3D57",
            "Arn"
          ]
        },
        "Runtime": "python3.8",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 60,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "S3EventHandlerRoleDefaultPolicy4200EF33",
        "S3EventHandlerRole822B3D57"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:PutBucketNotification",
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "Roles": [
          {
            "Ref": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "bucket resource is '*' due to circular dependency with bucket and role creation at the same time"
            },
            {
              "id": "W76",
              "reason": "SPCM for IAM policy document is higher than 25"
            }
          ]
        }
      }
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Description": "AWS CloudFormation handler for \"Custom::S3BucketNotifications\" resources (@aws-cdk/aws-s3)",
        "Code": {
          "ZipFile": "import boto3  # type: ignore\nimport json\nimport logging\nimport urllib.request\n\ns3 = boto3.client(\"s3\")\n\nEVENTBRIDGE_CONFIGURATION = 'EventBridgeConfiguration'\n\nCONFIGURATION_TYPES = [\"TopicConfigurations\", \"QueueConfigurations\", \"LambdaFunctionConfigurations\"]\n\ndef handler(event: dict, context):\n  response_status = \"SUCCESS\"\n  error_message = \"\"\n  try:\n    props = event[\"ResourceProperties\"]\n    bucket = props[\"BucketName\"]\n    notification_configuration = props[\"NotificationConfiguration\"]\n    request_type = event[\"RequestType\"]\n    managed = props.get('Managed', 'true').lower() == 'true'\n    stack_id = event['StackId']\n\n    if managed:\n      config = handle_managed(request_type, notification_configuration)\n    else:\n      config = handle_unmanaged(bucket, stack_id, request_type, notification_configuration)\n\n    put_bucket_notification_configuration(bucket, config)\n  except Exception as e:\n    logging.exception(\"Failed to put bucket notification configuration\")\n    response_status = \"FAILED\"\n    error_message = f\"Error: {str(e)}. \"\n  finally:\n    submit_response(event, context, response_status, error_message)\n\ndef handle_managed(request_type, notification_configuration):\n  if request_type == 'Delete':\n    return {}\n  return notification_configuration\n\ndef handle_unmanaged(bucket, stack_id, request_type, notification_configuration):\n  external_notifications = find_external_notifications(bucket, stack_id)\n\n  if request_type == 'Delete':\n    return external_notifications\n\n  def with_id(notification):\n    notification['Id'] = f\"{stack_id}-{hash(json.dumps(notification, sort_keys=True))}\"\n    return notification\n\n  notifications = {}\n  for t in CONFIGURATION_TYPES:\n    external = external_notifications.get(t, [])\n    incoming = [with_id(n) for n in notification_configuration.get(t, [])]\n    notifications[t] = external + incoming\n\n  if EVENTBRIDGE_CONFIGURATION in notification_configuration:\n    notifications[EVENTBRIDGE_CONFIGURATION] = notification_configuration[EVENTBRIDGE_CONFIGURATION]\n  elif EVENTBRIDGE_CONFIGURATION in external_notifications:\n    notifications[EVENTBRIDGE_CONFIGURATION] = external_notifications[EVENTBRIDGE_CONFIGURATION]\n\n  return notifications\n\ndef find_external_notifications(bucket, stack_id):\n  existing_notifications = get_bucket_notification_configuration(bucket)\n  external_notifications = {}\n  for t in CONFIGURATION_TYPES:\n    external_notifications[t] = [n for n in existing_notifications.get(t, []) if not n['Id'].startswith(f\"{stack_id}-\")]\n\n  if EVENTBRIDGE_CONFIGURATION in existing_notifications:\n    external_notifications[EVENTBRIDGE_CONFIGURATION] = existing_notifications[EVENTBRIDGE_CONFIGURATION]\n\n  return external_notifications\n\ndef get_bucket_notification_configuration(bucket):\n  return s3.get_bucket_notification_configuration(Bucket=bucket)\n\ndef put_bucket_notification_configuration(bucket, notification_configuration):\n  s3.put_bucket_notification_configuration(Bucket=bucket, NotificationConfiguration=notification_configuration)\n\ndef submit_response(event: dict, context, response_status: str, error_message: str):\n  response_body = json.dumps(\n    {\n      \"Status\": response_status,\n      \"Reason\": f\"{error_message}See the details in CloudWatch Log Stream: {context.log_stream_name}\",\n      \"PhysicalResourceId\": event.get(\"PhysicalResourceId\") or event[\"LogicalResourceId\"],\n      \"StackId\": event[\"StackId\"],\n      \"RequestId\": event[\"RequestId\"],\n      \"LogicalResourceId\": event[\"LogicalResourceId\"],\n      \"NoEcho\": False,\n    }\n  ).encode(\"utf-8\")\n  headers = {\"content-type\": \"\", \"content-length\": str(len(response_body))}\n  try:\n    req = urllib.request.Request(url=event[\"ResponseURL\"], headers=headers, data=response_body, method=\"PUT\")\n    with urllib.request.urlopen(req) as response:\n      print(response.read().decode(\"utf-8\"))\n    print(\"Status code: \" + response.reason)\n  except Exception as e:\n      print(\"send(..) failed executing request.urlopen(..): \" + str(e))\n"
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
            "Arn"
          ]
        },
        "Runtime": "python3.9",
        "Timeout": 300,
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "DependsOn": [
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "DataCatalog": {
      "Type": "AWS::Glue::Database",
      "Properties": {
        "CatalogId": {
          "Ref": "AWS::AccountId"
        },
        "DatabaseInput": {
          "Name": {
            "Fn::Join": [
              "",
              [
                "forecast_",
                {
                  "Fn::GetAtt": [
                    "DataBucketNameDataBucketNameNameResourceF097015A",
                    "Id"
                  ]
                }
              ]
            ]
          },
          "Description": {
            "Fn::Join": [
              "",
              [
                "Database for Improving Forecast Accuracy with Machine Learning (stack: ",
                {
                  "Ref": "AWS::StackName"
                },
                ")"
              ]
            ]
          }
        }
      }
    },
    "GlueResourcesGlueRoleED8230FC": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "glue.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:GetBucketLocation",
                    "s3:ListBucket",
                    "s3:ListBucketMultipartUploads",
                    "s3:ListMultipartUploadParts",
                    "s3:PutObject",
                    "s3:AbortMultipartUpload",
                    "s3:DeleteObject"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "AthenaBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "ForecastBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "AthenaBucket",
                        "Arn"
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "S3SolutionAccess"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:ListBucket"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Sub": [
                        "arn:${AWS::Partition}:s3:::${bucket}-${AWS::Region}/*",
                        {
                          "bucket": {
                            "Fn::FindInMap": [
                              "SourceCode",
                              "General",
                              "S3Bucket"
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "Fn::Sub": [
                        "arn:${AWS::Partition}:s3:::${bucket}-${AWS::Region}",
                        {
                          "bucket": {
                            "Fn::FindInMap": [
                              "SourceCode",
                              "General",
                              "S3Bucket"
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "S3StackAccess"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "forecast:Describe*",
                    "forecast:List*"
                  ],
                  "Effect": "Allow",
                  "Resource": "*"
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "ForecastRead"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws-glue/jobs/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "CloudwatchLogsAccess"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "glue:GetDatabase",
                    "glue:GetTable",
                    "glue:GetPartitions",
                    "glue:DeleteTable",
                    "glue:CreateTable",
                    "glue:BatchCreatePartition",
                    "glue:GetSecurityConfiguration",
                    "glue:GetSecurityConfigurations",
                    "glue:GetDataCatalogEncryptionSettings"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          "arn:",
                          {
                            "Ref": "AWS::Partition"
                          },
                          ":glue:",
                          {
                            "Ref": "AWS::Region"
                          },
                          ":",
                          {
                            "Ref": "AWS::AccountId"
                          },
                          ":catalog"
                        ]
                      ]
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          "arn:",
                          {
                            "Ref": "AWS::Partition"
                          },
                          ":glue:",
                          {
                            "Ref": "AWS::Region"
                          },
                          ":",
                          {
                            "Ref": "AWS::AccountId"
                          },
                          ":",
                          {
                            "Ref": "DataCatalog"
                          }
                        ]
                      ]
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          "arn:",
                          {
                            "Ref": "AWS::Partition"
                          },
                          ":glue:",
                          {
                            "Ref": "AWS::Region"
                          },
                          ":",
                          {
                            "Ref": "AWS::AccountId"
                          },
                          ":table/",
                          {
                            "Ref": "DataCatalog"
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          "arn:",
                          {
                            "Ref": "AWS::Partition"
                          },
                          ":glue:",
                          {
                            "Ref": "AWS::Region"
                          },
                          ":",
                          {
                            "Ref": "AWS::AccountId"
                          },
                          ":database/",
                          {
                            "Ref": "DataCatalog"
                          }
                        ]
                      ]
                    }
                  ]
                },
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:GetBucketLocation",
                    "s3:ListBucket",
                    "s3:ListBucketMultipartUploads",
                    "s3:ListMultipartUploadParts",
                    "s3:PutObject",
                    "s3:AbortMultipartUpload",
                    "s3:DeleteObject"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "AthenaBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "AthenaBucket",
                        "Arn"
                      ]
                    }
                  ]
                },
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:GetBucketLocation",
                    "s3:ListBucket",
                    "s3:ListBucketMultipartUploads",
                    "s3:ListMultipartUploadParts",
                    "s3:PutObject",
                    "s3:AbortMultipartUpload",
                    "s3:DeleteObject"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "ForecastBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "GlueAccess"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W11",
              "reason": "Require access to all resources; Not all Amazon Forecast resources support resource based policy"
            }
          ]
        }
      }
    },
    "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleC3CC7833": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleDefaultPolicyC84180D7": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Fn::FindInMap": [
                          "SourceCode",
                          "General",
                          "S3Bucket"
                        ]
                      },
                      "-",
                      {
                        "Ref": "AWS::Region"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Fn::FindInMap": [
                          "SourceCode",
                          "General",
                          "S3Bucket"
                        ]
                      },
                      "-",
                      {
                        "Ref": "AWS::Region"
                      },
                      "/",
                      {
                        "Fn::FindInMap": [
                          "SourceCode",
                          "General",
                          "KeyPrefix"
                        ]
                      },
                      "/glue/jobs/forecast_etl.py"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":s3:::",
                    {
                      "Ref": "ForecastBucket"
                    },
                    "/glue/forecast_etl.py"
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleDefaultPolicyC84180D7",
        "Roles": [
          {
            "Ref": "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleC3CC7833"
          }
        ]
      }
    },
    "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionCBD9121F": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionCBD9121F.zip"
              ]
            ]
          }
        },
        "Handler": "url_downloader.handler",
        "Role": {
          "Fn::GetAtt": [
            "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleC3CC7833",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 300
      },
      "DependsOn": [
        "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleDefaultPolicyC84180D7",
        "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionRoleC3CC7833"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "GlueResourcesGlueJobGlueJobUrlDownloader1C11BAE8": {
      "Type": "Custom::UrlDownloader",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "GlueResourcesGlueJobGlueJobUrlDownloaderFunctionCBD9121F",
            "Arn"
          ]
        },
        "DestinationBucket": {
          "Ref": "ForecastBucket"
        },
        "DestinationKey": "glue/forecast_etl.py",
        "SourceBucket": {
          "Fn::Join": [
            "",
            [
              {
                "Fn::FindInMap": [
                  "SourceCode",
                  "General",
                  "S3Bucket"
                ]
              },
              "-",
              {
                "Ref": "AWS::Region"
              }
            ]
          ]
        },
        "SourceKey": {
          "Fn::Join": [
            "",
            [
              {
                "Fn::FindInMap": [
                  "SourceCode",
                  "General",
                  "KeyPrefix"
                ]
              },
              "/glue/jobs/forecast_etl.py"
            ]
          ]
        },
        "Scheme": "s3"
      }
    },
    "GlueResourcesForecastETLJob2388FAC6": {
      "Type": "AWS::Glue::Job",
      "Properties": {
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-Forecast-ETL"
            ]
          ]
        },
        "Description": "Improving Forecast Accuracy with Machine Learning - Glue Job",
        "Role": {
          "Fn::GetAtt": [
            "GlueResourcesGlueRoleED8230FC",
            "Arn"
          ]
        },
        "Command": {
          "Name": "glueetl",
          "PythonVersion": "3",
          "ScriptLocation": {
            "Fn::Join": [
              "",
              [
                "s3://",
                {
                  "Ref": "ForecastBucket"
                },
                "/glue/forecast_etl.py"
              ]
            ]
          }
        },
        "DefaultArguments": {
          "--region": {
            "Ref": "AWS::Region"
          },
          "--account_id": {
            "Ref": "AWS::AccountId"
          },
          "--database": {
            "Ref": "DataCatalog"
          },
          "--data_bucket": {
            "Ref": "ForecastBucket"
          },
          "--job-bookmark-option": "job-bookmark-disable",
          "--job-language": "python",
          "--encryption-type": "sse-s3",
          "--additional-python-modules": "boto3==1.26.83"
        },
        "GlueVersion": "2.0",
        "WorkerType": "G.1X",
        "NumberOfWorkers": 2,
        "ExecutionProperty": {
          "MaxConcurrentRuns": 5
        }
      }
    },
    "AthenaWorkGroup": {
      "Type": "AWS::Athena::WorkGroup",
      "Properties": {
        "Name": {
          "Ref": "AWS::StackName"
        },
        "Description": {
          "Fn::Join": [
            "",
            [
              "Workgroup for Improving Forecast Accuracy with Machine Learning (stack: ",
              {
                "Ref": "AWS::StackName"
              },
              ")"
            ]
          ]
        },
        "State": "ENABLED",
        "RecursiveDeleteOption": true,
        "WorkGroupConfiguration": {
          "EnforceWorkGroupConfiguration": true,
          "EngineVersion": {
            "SelectedEngineVersion": "Athena engine version 2"
          },
          "ResultConfiguration": {
            "OutputLocation": {
              "Fn::Join": [
                "",
                [
                  "s3://",
                  {
                    "Ref": "AthenaBucket"
                  },
                  "/query-results"
                ]
              ]
            },
            "EncryptionConfiguration": {
              "EncryptionOption": "SSE_S3"
            }
          }
        }
      }
    },
    "NotebookInstanceRole4F733B8B": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "sagemaker.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/sagemaker/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "SagemakerNotebookCloudWatchLogs"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:GetBucketLocation",
                    "s3:ListBucket",
                    "s3:ListObjects",
                    "s3:ListBucketMultipartUploads",
                    "s3:ListMultipartUploadParts",
                    "s3:PutObject",
                    "s3:AbortMultipartUpload",
                    "s3:DeleteObject"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "ForecastBucket",
                              "Arn"
                            ]
                          },
                          "/*"
                        ]
                      ]
                    },
                    {
                      "Fn::GetAtt": [
                        "ForecastBucket",
                        "Arn"
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "ForecastBucketAccessPolicy"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "sagemaker:ListTags",
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":sagemaker:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":notebook-instance/*-aws-forecast-visualization"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "SagemakerNotebookListTags"
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "s3:GetObject",
                    "s3:ListBucket",
                    "s3:ListObjects"
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::Sub": [
                        "arn:${AWS::Partition}:s3:::${bucket}-${AWS::Region}/*",
                        {
                          "bucket": {
                            "Fn::FindInMap": [
                              "SourceCode",
                              "General",
                              "S3Bucket"
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "Fn::Sub": [
                        "arn:${AWS::Partition}:s3:::${bucket}-${AWS::Region}",
                        {
                          "bucket": {
                            "Fn::FindInMap": [
                              "SourceCode",
                              "General",
                              "S3Bucket"
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "NotebookBucketAccessPolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      },
      "Condition": "CreateNotebook"
    },
    "NotebookLifecycleConfig48B89718": {
      "Type": "AWS::SageMaker::NotebookInstanceLifecycleConfig",
      "Condition": "CreateNotebook",
      "Properties": {
        "OnStart": [
          {
            "Content": {
              "Fn::Base64": "#!/usr/bin/env python3\n\n# #####################################################################################################################\n#  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.                                                 #\n#                                                                                                                     #\n#  Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance     #\n#  with the License. You may obtain a copy of the License at                                                          #\n#                                                                                                                     #\n#   http://www.apache.org/licenses/LICENSE-2.0                                                                        #\n#                                                                                                                     #\n#  Unless required by applicable law or agreed to in writing, software distributed under the License is distributed   #\n#  on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for  #\n#  the specific language governing permissions and limitations under the License.                                     #\n# #####################################################################################################################\n\nimport base64\nimport contextlib\nimport grp\nimport json\nimport logging\nimport os\nimport pwd\nimport subprocess\nimport sys\n\nsubprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", \"boto3==1.26.83\"])\nsubprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", \"botocore==1.29.85\"])\n\nimport boto3\nfrom botocore.config import Config\n\nJUPYTER_ENV_FILE = \"/etc/profile.d/jupyter-env.sh\"\nNOTEBOOKS = [\"SampleVisualization.ipynb\"]\nSOLUTION_ID = \"SO0123\"\nSOLUTION_VERSION = \"v1.5.5\"\nCLIENT_CONFIG = Config(\n    retries={\"max_attempts\": 10, \"mode\": \"standard\"},\n    user_agent_extra=f\"AwsSolution/{SOLUTION_ID}/{SOLUTION_VERSION}\",\n)\n\n\nlogging.basicConfig( # NOSONAR - this logging configuration is safe for this solution\n    format=\"[%(levelname)s]\\t%(asctime)s.%(msecs)dZ\\t%(message)s\\n\",\n    datefmt=\"%Y-%m-%dT%H:%M:%S\",\n    level=logging.INFO,\n)\nsagemaker_cli = boto3.client(\"sagemaker\", config=CLIENT_CONFIG)\ns3_cli = boto3.client(\"s3\", config=CLIENT_CONFIG)\n\n\ndef get_tag(name, is_base64=False):\n    with open(\"/opt/ml/metadata/resource-metadata.json\", \"r\") as instance_metadata:\n        metadata = instance_metadata.read()\n    notebook_instance_arn = json.loads(metadata).get(\"ResourceArn\")\n    logging.debug(\"Notebook instance ARN is %s\" % notebook_instance_arn)\n\n    notebook_instance_tags = sagemaker_cli.list_tags(\n        ResourceArn=notebook_instance_arn\n    ).get(\"Tags\")\n    tag = next(\n        iter(\n            [\n                tag.get(\"Value\")\n                for tag in notebook_instance_tags\n                if tag.get(\"Key\") == name\n            ]\n        ),\n        None,\n    )\n\n    if is_base64:\n        tag = base64.b64decode(tag).decode(\"utf-8\")\n\n    logging.info(\"Tag %s value is %s\" % (name, tag))\n    return tag\n\n\ndef set_jupyter_env_from_tag(name, is_base64=False):\n    tag = get_tag(name, is_base64)\n\n    with open(JUPYTER_ENV_FILE, \"a\") as env_file:\n        env_file.write(f\"export {name}={tag}\\n\")\n\n    return tag\n\n\ndef clean_env_file():\n    with contextlib.suppress(FileNotFoundError):\n        os.remove(JUPYTER_ENV_FILE)\n\n\ndef restart_notebook_server():\n    logging.info(\"Restarting Jupyter Server\")\n    result = subprocess.run([\"systemctl\", \"restart\", \"jupyter-server.service\"])\n    if result.returncode != 0:\n        logging.error(\"Failed to restart Jupyter Server\")\n\n\ndef copy_files(\n    source_bucket, source_prefix, destination, username=\"ec2-user\", groupname=\"ec2-user\"\n):\n\n    for notebook in NOTEBOOKS:\n        key = f\"{source_prefix}/{notebook}\"\n\n        local_path = os.path.join(\n            destination, key.replace(source_prefix, \"\").strip(\"/\")\n        )\n\n        logging.info(\"Downloading s3://%s/%s to %s\" % (source_bucket, key, local_path))\n        local_dir = os.path.dirname(local_path)\n        os.makedirs(local_dir, exist_ok=True)\n        response = s3_cli.get_object(Bucket=source_bucket, Key=key)\n\n        with open(local_path, \"wb\") as local_file:\n            local_file.write(response.get(\"Body\").read())\n\n    try:\n        uid = pwd.getpwnam(username).pw_uid\n        gid = grp.getgrnam(groupname).gr_gid\n    except KeyError:\n        return\n\n    logging.info(\"Ensuring %s is owned by %s:%s\" % (destination, username, groupname))\n    result = subprocess.run([\"chown\", \"-R\", f\"{username}:{groupname}\", destination])\n    if result.returncode != 0:\n        logging.error(\"Failed to set notebook directory ownership\")\n\n    for root, directories, files in os.walk(destination):\n        for f in files:\n            os.chown(os.path.join(root, f), uid, gid)\n            os.chmod(local_path, mode=0o664) # NOSONAR - this is a safe permission.\n\n\nif __name__ == \"__main__\":\n    clean_env_file()\n\n    # Jupyter needs to know about the Forecast Bucket\n    set_jupyter_env_from_tag(\"FORECAST_BUCKET\", is_base64=True)\n\n    # Copy the notebooks from the public S3 bucket to our notebook instance\n    nb_bucket = get_tag(\"NOTEBOOK_BUCKET\", is_base64=True)\n    nb_prefix = get_tag(\"NOTEBOOK_PREFIX\", is_base64=True)\n\n    destination = os.path.join(\"/home/ec2-user/SageMaker\", nb_prefix)\n    copy_files(\n        source_bucket=nb_bucket, source_prefix=nb_prefix, destination=destination\n    )\n\n    restart_notebook_server()\n"
            }
          }
        ]
      }
    },
    "NotebookInstance": {
      "Type": "AWS::SageMaker::NotebookInstance",
      "Properties": {
        "InstanceType": {
          "Ref": "NotebookInstanceType"
        },
        "LifecycleConfigName": {
          "Fn::GetAtt": [
            "NotebookLifecycleConfig48B89718",
            "NotebookInstanceLifecycleConfigName"
          ]
        },
        "NotebookInstanceName": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-aws-forecast-visualization"
            ]
          ]
        },
        "PlatformIdentifier": "notebook-al2-v1",
        "RoleArn": {
          "Fn::GetAtt": [
            "NotebookInstanceRole4F733B8B",
            "Arn"
          ]
        },
        "Tags": [
          {
            "Key": "FORECAST_BUCKET",
            "Value": {
              "Fn::Base64": {
                "Ref": "ForecastBucket"
              }
            }
          },
          {
            "Key": "NOTEBOOK_BUCKET",
            "Value": {
              "Fn::Base64": {
                "Fn::Sub": [
                  "${bucket}-${region}",
                  {
                    "bucket": {
                      "Fn::FindInMap": [
                        "SourceCode",
                        "General",
                        "S3Bucket"
                      ]
                    },
                    "region": {
                      "Ref": "AWS::Region"
                    }
                  }
                ]
              }
            }
          },
          {
            "Key": "NOTEBOOK_PREFIX",
            "Value": {
              "Fn::Base64": {
                "Fn::Sub": [
                  "${prefix}/notebooks",
                  {
                    "prefix": {
                      "Fn::FindInMap": [
                        "SourceCode",
                        "General",
                        "KeyPrefix"
                      ]
                    }
                  }
                ]
              }
            }
          },
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "VolumeSizeInGB": {
          "Ref": "NotebookVolumeSize"
        }
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W1201",
              "reason": "Require access to all resources; Not all Amazon Forecast resources support resource based policy"
            }
          ]
        }
      },
      "Condition": "CreateNotebook"
    },
    "NotebookNotebooksAwsCliLayerEED8EF07": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
        "Content": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "NotebookNotebooksAwsCliLayerEED8EF07.zip"
              ]
            ]
          }
        },
        "Description": "/opt/awscli/aws"
      },
      "Condition": "CreateNotebook"
    },
    "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleB374F6CC": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FB455F463": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FB455F463.zip"
              ]
            ]
          }
        },
        "Handler": "url_helper.handler",
        "Role": {
          "Fn::GetAtt": [
            "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleB374F6CC",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 30
      },
      "DependsOn": [
        "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleB374F6CC"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "ForecastDefaultsForecastDefaultsUrlInfo8B8F1046": {
      "Type": "Custom::UrlHelper",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "ForecastDefaultsUrlHelper24E40850EBEF42CDA0975895A851DC9FB455F463",
            "Arn"
          ]
        },
        "Url": {
          "Ref": "ForecastStackParametersForecastDefaultsUrl7C63E324"
        }
      },
      "Condition": "ForecastDefaultsForecastDefaultsURLProvided996F6EEE"
    },
    "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleBFB667DB": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FE8B14FC3": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FE8B14FC3.zip"
              ]
            ]
          }
        },
        "Handler": "url_helper.handler",
        "Role": {
          "Fn::GetAtt": [
            "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleBFB667DB",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 30
      },
      "DependsOn": [
        "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRoleBFB667DB"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "TTSTTSUrlInfoF93A2690": {
      "Type": "Custom::UrlHelper",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "TTSUrlHelper24E40850EBEF42CDA0975895A851DC9FE8B14FC3",
            "Arn"
          ]
        },
        "Url": {
          "Ref": "ForecastStackParametersTargetTimeSeriesUrlF02035C1"
        }
      },
      "Condition": "TTSTTSURLProvidedCB709844"
    },
    "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRole794BEECB": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9F86746E6C": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9F86746E6C.zip"
              ]
            ]
          }
        },
        "Handler": "url_helper.handler",
        "Role": {
          "Fn::GetAtt": [
            "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRole794BEECB",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 30
      },
      "DependsOn": [
        "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9FRole794BEECB"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "RTSRTSUrlInfoB4606409": {
      "Type": "Custom::UrlHelper",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "RTSUrlHelper24E40850EBEF42CDA0975895A851DC9F86746E6C",
            "Arn"
          ]
        },
        "Url": {
          "Ref": "ForecastStackParametersRelatedTimeSeriesUrl7D41C268"
        }
      },
      "Condition": "RTSRTSURLProvided5D71A457"
    },
    "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FRole34B85633": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ],
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ]
      }
    },
    "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FE7284C56": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Join": [
              "-",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "S3Bucket"
                  ]
                },
                {
                  "Ref": "AWS::Region"
                }
              ]
            ]
          },
          "S3Key": {
            "Fn::Join": [
              "/",
              [
                {
                  "Fn::FindInMap": [
                    "SourceCode",
                    "General",
                    "KeyPrefix"
                  ]
                },
                "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FE7284C56.zip"
              ]
            ]
          }
        },
        "Handler": "url_helper.handler",
        "Role": {
          "Fn::GetAtt": [
            "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FRole34B85633",
            "Arn"
          ]
        },
        "Runtime": "python3.7",
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "Timeout": 30
      },
      "DependsOn": [
        "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FRole34B85633"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "functions deployed by this solution do not require VPC access"
            },
            {
              "id": "W92",
              "reason": "functions deployed by this solution do not require reserved concurrency"
            },
            {
              "id": "W58",
              "reason": "functions deployed by this solution use custom policy to write to CloudWatch logs"
            }
          ]
        }
      }
    },
    "MDMDUrlInfo6C3F2F8B": {
      "Type": "Custom::UrlHelper",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "MDUrlHelper24E40850EBEF42CDA0975895A851DC9FE7284C56",
            "Arn"
          ]
        },
        "Url": {
          "Ref": "ForecastStackParametersMetadataUrl06727156"
        }
      },
      "Condition": "MDMDURLProvided1BEF6CAA"
    },
    "Downloader": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "Parameters": {
          "DestinationBucket": {
            "Ref": "ForecastBucket"
          },
          "ForecastName": {
            "Ref": "ForecastStackParametersForecastNameDF9B9CAC"
          },
          "Version": "v1.5.5",
          "ForecastDefaultsUrl": {
            "Fn::If": [
              "ForecastDefaultsForecastDefaultsURLProvided996F6EEE",
              {
                "Fn::GetAtt": [
                  "ForecastDefaultsForecastDefaultsUrlInfo8B8F1046",
                  "Url"
                ]
              },
              ""
            ]
          },
          "ForecastDefaultsScheme": {
            "Fn::If": [
              "ForecastDefaultsForecastDefaultsURLProvided996F6EEE",
              {
                "Fn::GetAtt": [
                  "ForecastDefaultsForecastDefaultsUrlInfo8B8F1046",
                  "Scheme"
                ]
              },
              ""
            ]
          },
          "ForecastDefaultsBucket": {
            "Fn::If": [
              "ForecastDefaultsForecastDefaultsURLProvided996F6EEE",
              {
                "Fn::GetAtt": [
                  "ForecastDefaultsForecastDefaultsUrlInfo8B8F1046",
                  "Bucket"
                ]
              },
              ""
            ]
          },
          "ForecastDefaultsKey": {
            "Fn::If": [
              "ForecastDefaultsForecastDefaultsURLProvided996F6EEE",
              {
                "Fn::GetAtt": [
                  "ForecastDefaultsForecastDefaultsUrlInfo8B8F1046",
                  "Key"
                ]
              },
              ""
            ]
          },
          "TTSUrl": {
            "Fn::If": [
              "TTSTTSURLProvidedCB709844",
              {
                "Fn::GetAtt": [
                  "TTSTTSUrlInfoF93A2690",
                  "Url"
                ]
              },
              ""
            ]
          },
          "TTSScheme": {
            "Fn::If": [
              "TTSTTSURLProvidedCB709844",
              {
                "Fn::GetAtt": [
                  "TTSTTSUrlInfoF93A2690",
                  "Scheme"
                ]
              },
              ""
            ]
          },
          "TTSBucket": {
            "Fn::If": [
              "TTSTTSURLProvidedCB709844",
              {
                "Fn::GetAtt": [
                  "TTSTTSUrlInfoF93A2690",
                  "Bucket"
                ]
              },
              ""
            ]
          },
          "TTSKey": {
            "Fn::If": [
              "TTSTTSURLProvidedCB709844",
              {
                "Fn::GetAtt": [
                  "TTSTTSUrlInfoF93A2690",
                  "Key"
                ]
              },
              ""
            ]
          },
          "RTSUrl": {
            "Fn::If": [
              "RTSRTSURLProvided5D71A457",
              {
                "Fn::GetAtt": [
                  "RTSRTSUrlInfoB4606409",
                  "Url"
                ]
              },
              ""
            ]
          },
          "RTSScheme": {
            "Fn::If": [
              "RTSRTSURLProvided5D71A457",
              {
                "Fn::GetAtt": [
                  "RTSRTSUrlInfoB4606409",
                  "Scheme"
                ]
              },
              ""
            ]
          },
          "RTSBucket": {
            "Fn::If": [
              "RTSRTSURLProvided5D71A457",
              {
                "Fn::GetAtt": [
                  "RTSRTSUrlInfoB4606409",
                  "Bucket"
                ]
              },
              ""
            ]
          },
          "RTSKey": {
            "Fn::If": [
              "RTSRTSURLProvided5D71A457",
              {
                "Fn::GetAtt": [
                  "RTSRTSUrlInfoB4606409",
                  "Key"
                ]
              },
              ""
            ]
          },
          "MDUrl": {
            "Fn::If": [
              "MDMDURLProvided1BEF6CAA",
              {
                "Fn::GetAtt": [
                  "MDMDUrlInfo6C3F2F8B",
                  "Url"
                ]
              },
              ""
            ]
          },
          "MDScheme": {
            "Fn::If": [
              "MDMDURLProvided1BEF6CAA",
              {
                "Fn::GetAtt": [
                  "MDMDUrlInfo6C3F2F8B",
                  "Scheme"
                ]
              },
              ""
            ]
          },
          "MDBucket": {
            "Fn::If": [
              "MDMDURLProvided1BEF6CAA",
              {
                "Fn::GetAtt": [
                  "MDMDUrlInfo6C3F2F8B",
                  "Bucket"
                ]
              },
              ""
            ]
          },
          "MDKey": {
            "Fn::If": [
              "MDMDURLProvided1BEF6CAA",
              {
                "Fn::GetAtt": [
                  "MDMDUrlInfo6C3F2F8B",
                  "Key"
                ]
              },
              ""
            ]
          },
          "referencetoforecaststackcdkRegistrySetup7553D80DArn": {
            "Fn::GetAtt": [
              "RegistrySetupCC2515F0",
              "Arn"
            ]
          }
        },
        "Tags": [
          {
            "Key": "SOLUTION_ID",
            "Value": "SO0123"
          },
          {
            "Key": "SOLUTION_NAME",
            "Value": "improving-forecast-accuracy-with-machine-learning"
          },
          {
            "Key": "SOLUTION_VERSION",
            "Value": "v1.5.5"
          }
        ],
        "TemplateURL": {
          "Fn::Join": [
            "",
            [
              "https://",
              "solutions-reference",
              ".s3.",
              {
                "Ref": "AWS::URLSuffix"
              },
              "/",
              {
                "Fn::FindInMap": [
                  "SourceCode",
                  "General",
                  "KeyPrefix"
                ]
              },
              "/",
              "improving-forecast-accuracy-with-machine-learning-downloader.template"
            ]
          ]
        }
      },
      "DependsOn": [
        "RegistrySetupCC2515F0"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:solutions:templateid": "Downloader",
        "aws:solutions:templatename": "improving-forecast-accuracy-with-machine-learning-downloader.template"
      },
      "Condition": "CreateForecast"
    },
    "AppRegistryAspectAppAttributes31FE442B": {
      "Type": "AWS::ServiceCatalogAppRegistry::AttributeGroup",
      "Properties": {
        "Attributes": {
          "applicationType": "AWS-Solutions",
          "version": "v1.5.5",
          "solutionID": "SO0123",
          "solutionName": "improving-forecast-accuracy-with-machine-learning"
        },
        "Description": "Attributes for Solutions Metadata",
        "Name": {
          "Fn::Join": [
            "",
            [
              "AttrGrp-",
              {
                "Ref": "AWS::StackName"
              }
            ]
          ]
        },
        "Tags": {
          "SOLUTION_ID": "SO0123",
          "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
          "SOLUTION_VERSION": "v1.5.5"
        }
      }
    },
    "AppRegistryAspectAppAttributesApplicationAttributeGroupAssociation8831debdbe0a490273BA": {
      "Type": "AWS::ServiceCatalogAppRegistry::AttributeGroupAssociation",
      "Properties": {
        "Application": {
          "Fn::GetAtt": [
            "RegistrySetupCC2515F0",
            "Id"
          ]
        },
        "AttributeGroup": {
          "Fn::GetAtt": [
            "AppRegistryAspectAppAttributes31FE442B",
            "Id"
          ]
        }
      }
    },
    "RegistrySetupCC2515F0": {
      "Type": "AWS::ServiceCatalogAppRegistry::Application",
      "Properties": {
        "Description": "Service Catalog application to track and manage all your resources for the solution improving-forecast-accuracy-with-machine-learning",
        "Name": {
          "Fn::Join": [
            "-",
            [
              "App",
              {
                "Ref": "AWS::StackName"
              },
              {
                "Fn::FindInMap": [
                  "Solution",
                  "Data",
                  "AppRegistryName"
                ]
              }
            ]
          ]
        },
        "Tags": {
          "SOLUTION_ID": "SO0123",
          "SOLUTION_NAME": "improving-forecast-accuracy-with-machine-learning",
          "SOLUTION_VERSION": "v1.5.5",
          "Solutions:ApplicationType": "AWS-Solutions",
          "Solutions:SolutionID": "SO0123",
          "Solutions:SolutionName": "improving-forecast-accuracy-with-machine-learning",
          "Solutions:SolutionVersion": "v1.5.5"
        }
      }
    },
    "AppRegistryAssociation": {
      "Type": "AWS::ServiceCatalogAppRegistry::ResourceAssociation",
      "Properties": {
        "Application": {
          "Fn::GetAtt": [
            "RegistrySetupCC2515F0",
            "Id"
          ]
        },
        "Resource": {
          "Ref": "AWS::StackId"
        },
        "ResourceType": "CFN_STACK"
      }
    }
  },
  "Outputs": {
    "ForecastBucketName": {
      "Value": {
        "Ref": "ForecastBucket"
      },
      "Export": {
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-ForecastBucketName"
            ]
          ]
        }
      }
    },
    "AthenaBucketName": {
      "Value": {
        "Ref": "AthenaBucket"
      },
      "Export": {
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-AthenaBucketName"
            ]
          ]
        }
      }
    },
    "StepFunctionsName": {
      "Value": {
        "Fn::GetAtt": [
          "ForecastStateMachine425DE76B",
          "Name"
        ]
      },
      "Export": {
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-StepFunctionsName"
            ]
          ]
        }
      }
    }
  }
}